// Minimal shim of transformers for offline demo tests.
// Provides a `transformers.pipeline('feature-extraction', model)` API that
// returns a fake extractor producing deterministic embeddings for testing.
(function (global) {
  function fakeExtractor(model) {
    return async function (text, opts) {
      // produce a fixed-length embedding deterministically from text
      var seed = 0;
      for (var i = 0; i < text.length; i++) seed += text.charCodeAt(i);
      var len = 384;
      var arr = new Float32Array(len);
      for (var j = 0; j < len; j++) {
        arr[j] = ((seed + j * 997) % 1000) / 1000;
      }
      return { data: arr };
    };
  }

  global.transformers = {
    pipeline: function (type, model) {
      if (type !== 'feature-extraction') throw new Error('Unsupported pipeline type in shim');
      return fakeExtractor(model);
    }
  };
})(self);
